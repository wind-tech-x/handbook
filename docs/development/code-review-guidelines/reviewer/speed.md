---
sidebar_position: 4
---

# コードレビューのスピードについて
## なぜコードレビューは速いほうがよいのか？
Google では、個々の開発者がコードを書くスピードよりも、チーム全体が製品を作り上げるスピードを最適化することを重視しています。個人の開発速度も大切ですが、チーム全体の速度のほうがより重要です。

コードレビューが遅い場合、以下のような問題が起こります。

### チーム全体の速度が落ちる。
レビューを迅速に返さない人は、他の作業を進めているかもしれません。しかし、他のメンバーが新機能やバグ修正を行う際に、その CL（変更リスト）がレビューや再レビューを待つ間、数日、数週間、あるいは数か月も作業が滞ってしまいます。

### 開発者がコードレビューのプロセスに不満を抱く。
もしレビュアーが数日に1回しか返信をせず、そのたびに大きな修正を要求すると、開発者にとってはとても不満の残る状況になります。「レビュアーが厳しすぎる」という不満として表出することもあります。しかし、同じ内容の修正要求でも、開発者が更新を行うたびにすぐに返事が返ってくるのであれば、不満はあまり出ません。多くの不満は、実はコードレビューの「速度」が遅いことによって生じています。

### コードの健全性に影響が出る。
レビューが遅いと、開発者に「完璧なコードでなくてもいいから早くマージしたい」というプレッシャーがかかり、結果として質の低いコードが入ってしまう恐れがあります。また、コードのクリーンアップやリファクタリング、既存 CL の更なる改善といった活動もしづらくなります。

## どのくらい早くレビューするべきか？
集中しているタスク（コーディングなど）をしていないなら、CL が届いたらすぐにレビューを行うべきです。

遅くとも1営業日以内（つまり、翌日の朝まで）にはレビューに応答するようにしましょう。

これを実行すると、一般的な CL であれば、必要に応じて1日のうちに何度もレビューとフィードバックをやりとりできるようになります。

## スピード vs. 割り込み
個人の作業速度よりもチーム全体の速度が大切とはいえ、集中作業中にレビューのために自分を割り込ませる行為は控えるほうが結果的にチームの利益になります。研究によると、コーディングの途中で割り込まれると、元の作業に戻ってスムーズに再開するまでにかなりの時間がかかることが分かっています。

したがって、コードレビューをするのは、自分のタスクに一区切りついたタイミングが望ましいです。たとえば、コーディングが終わった後、昼食後、会議から戻ったとき、休憩から戻ったとき、などです。

## 迅速な応答
コードレビューの速さに関して重視すべきなのは、「CL 全体がレビューを経て提出されるまでの時間」よりも、むしろ各コメントに対する応答の速度です。もちろんレビュー全体が早く終わるに越したことはありませんが、個々の応答が素早いことが、開発者の不満を大きく軽減します。

もし、レビューに時間がかかりそうであれば、まず以下のような簡単な応答を送って、開発者に状況を伝えましょう。

「いつ頃レビューできるか」の目安を伝える
「より早くレビューできる他のレビュアー」を提案する
「大まかなコメント」を少しだけ伝える
（注：これらの応答のために自分のコーディングを中断してはいけません。休憩や作業の切れ目など、適切なタイミングで行います。）

レビュアーは「LGTM（Looks Good To Me）」を出すときに、「このコードが我々の基準を満たしていると確信できる」だけの十分な時間をレビューに費やす必要があります。ただし、それぞれの応答は可能な限り速くするべきです。

## 時差のあるレビュー（クロス・タイムゾーン）
他のタイムゾーンにいる開発者とやり取りする場合は、相手の就業時間中に対応できるように心がけましょう。もし相手がすでに退勤後であれば、翌日の業務開始までにレビューを完了できるようにするとよいでしょう。

## 「LGTM With Comments」について
コードレビューを早く進めるために、以下のようなケースではまだコメント（未解決の指摘）が残っていても、LGTM/Approval を出すことがあります。

レビュアーが「開発者が必ずコメント内容を適切に対処してくれる」と確信している。
コメント内容を開発者が対処しなくても問題ない場合。
提案が細かいもの（import のソートやスペルミス修正、余分な依存関係の削除など）で、必須ではない場合。
上記のどれに当てはまるかを、明確に示すとよいでしょう。

特に、開発者とレビュアーが異なるタイムゾーンにいる場合、コメントの修正が大した内容でないときは、「LGTM, Approval」を得るためだけに1日待たせるのは非効率です。こうした状況では、「LGTM With Comments」を強く検討すべきです。

## 大きな CL の扱い
もし非常に大きな CL が送られてきて、レビューに十分な時間を取れそうにない場合、通常はCL をいくつかの小さな単位に分割するように開発者に依頼してください。機能ごとに順次ビルドしていくように変更を分ければ、レビュアーにとっても楽になります。開発者にとっては手間かもしれませんが、レビュー全体にとっては有益です。

もし CL を分割できない場合、しかもすぐに詳細レビューを行うのが難しい場合は、少なくともCL の全体的な設計だけを先に確認し、問題点をコメントして開発者に返却してください。レビュアーの目標の一つは、常に開発者が「何らかの次の行動」を早急に取れるようにしてあげることです。もちろんコードの健全性を損なうほど妥協してはなりませんが、できるだけブロックしないようにしましょう。

コードレビューが時間とともに改善していく
これらのガイドラインを守り、かつレビュアーが厳格にレビュー基準を適用していくと、時間とともにレビュー全体のプロセスはどんどん速くなっていきます。開発者は「健全なコード」とはどういうものかを学び、最初から質の高い CL を提出するようになります。すると、レビューに要する時間はますます短縮されます。また、レビュアーも素早くレビューすることを覚え、不要な遅延が減ります。

ただし、コードレビュー基準や品質を安易に妥協してはいけません。コード品質を下げてスピードを上げようとしても、長期的には開発が早く進むことはありません。

## 緊急事態の場合
場合によっては、非常に短時間でレビューを通過させなければならない「緊急事態」が発生し、品質基準を緩和することもあるでしょう。ただし、「何が本当の緊急事態で、何がそうでないか」については、「What Is An Emergency?」で説明されているとおり、しっかり定義を確認してください。