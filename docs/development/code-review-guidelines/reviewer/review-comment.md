---
sidebar_position: 5
---

# コードレビューのコメントをどう書くか
## まとめ
* 思いやりを持つこと。
* 自分の指摘の根拠を説明すること。
* 「問題点を指摘するだけ」と「具体的な修正方法を提案する」のバランスを取ること。
* レビュアーに説明する代わりに、開発者にコードをシンプルにしたりコメントを追加させるよう促すこと。

## 礼儀
基本的に、開発者を尊重しながら、かつ明確かつ有益なコメントをすることが重要です。その一つの方法は、コードそのものについてコメントし、開発者本人を批判しないようにすることです。特に、相手が不快に感じるかもしれない内容や議論を呼びそうな内容については、この点を徹底するべきです。

たとえば、次の例を考えてみましょう。

悪い例:

「スレッドを使ったところで、明らかに並行性がメリットになっていないのに、なんでこんなことをしたんですか？」

良い例:

「私にはパフォーマンス面でのメリットが見えないので、この並行処理モデルはシステムを複雑にしているだけのように思います。もしパフォーマンス上の利点がないのであれば、複数スレッドを使うより単一スレッドで処理するのがベターだと思います。」

## 理由を説明する
上記の「良い例」では、なぜそのコメントをしているかを開発者に理解してもらうための説明があります。必ずしも毎回理由を書かなければならないわけではありませんが、時にはその意図や背景、ベストプラクティス、提案がどのようにコード健全性を高めるのか、といった説明を付け加えると良いでしょう。

ガイダンスを与える
基本的に、CL（変更リスト）を修正する責任は開発者にあります。レビュアーが詳細な設計案を提示したり、コードを書き直してあげたりする義務はありません。

とはいえ、全く非協力的であってよいという意味ではありません。問題点だけを指摘して、修正は開発者に任せるやり方と、具体的な指示やサンプルコードを提示するやり方のバランスを取ることが大切です。

問題点を指摘して開発者に考えさせるアプローチは、開発者の成長を促し、レビューもシンプルにしやすくなります。開発者はコードに最も精通しているため、往々にして自分なりに最適解を見つけられるからです。

一方で、場合によっては具体的な提案やコード例を示すほうが役立つこともあります。レビューの第一目的は「より良い CL」を仕上げることです。第二の目的は、開発者のスキルを高めて、今後のレビュー回数や指摘事項を減らしていくことです。

また、開発者が既にうまくできている点を見つけたら、それもコメントで称賛してあげてください。人は改善点だけでなく、うまくいっていることへの肯定からも学びます。たとえば「複雑だったアルゴリズムをきれいに整理した」「テストカバレッジが素晴らしい」「レビュアーである自分もこの CL から学びがあった」といった点を具体的に書くと良いでしょう。その際、「なぜそれを高く評価しているか」も添えると、開発者は良いプラクティスを続けやすくなります。

## コメントの重要度を明示する
レビューコメントの重要度を示すと、修正が「必須なのか、推奨なのか、単なる情報なのか」が開発者に分かりやすくなります。以下は例です。

* Nit:
これは細かいポイントです。一応、修正してほしい（したほうが良い）が、最終的な影響は大きくありません。
[参考文献](https://youneedaken.hatenablog.com/entry/2024/01/09/130803#Nit-nitpick)

* Optional (あるいは Consider):
「やってみると良いかもしれない」と思うが、厳密には必須ではありません。

* FYI:
「今後参考になるかもしれない情報」です。この CL で直す必要はありません。

こうしたラベルを使うことでレビューの意図が明確になり、開発者はコメントの優先度を判断しやすくなります。また、すべてのコメントを「必須修正」と誤解されるリスクも減らせます。

## 説明を受け入れる
もしあなたがあるコードを理解できず、開発者に説明を求めた場合、その結果としてコードをより分かりやすく書き換えてもらうのが理想的です。場合によっては、コメントをコードに追加する対応でもかまいませんが、複雑すぎるコードを「コメントで解説する」だけに終わらないよう注意が必要です。

コードレビューのツール上だけに書かれた説明は、将来そのコードを読む人には役立ちません。特殊な事情（レビュアーがあまり詳しくない領域で、通常の読者なら容易に理解できることであるなど）を除けば、コードレビューのやりとりだけに留まる説明は好ましくないでしょう。