---
sidebar_position: 5
---

# コードレビューのコメントをどう書くか
## まとめ
* 思いやりを持つこと。
* 自分の指摘の根拠を説明すること。
* 「問題点を指摘するだけ」と「具体的な修正方法を提案する」のバランスを取ること。
* レビュアーに説明する代わりに、開発者にコードをシンプルにしたりコメントを追加させるよう促すこと。

## 礼儀
基本的に、開発者を尊重しながら、かつ明確かつ有益なコメントをすることが重要である。

* コードそのものについてコメントし、開発者本人を批判しないようにすること。

特に、相手が不快に感じるかもしれない内容や議論を呼びそうな内容については、この点を徹底するべき。

たとえば、次の例を見てみよう。

悪い例:

>「スレッドを使って、並列処理しても意味がないのに、なんでこんなことをしたんですか？」

良い例:

>「私にはパフォーマンス面でのメリットが見えないので、この並行処理モデルはシステムを複雑にしているだけのように思います。もしパフォーマンス上の利点がないのであれば、複数スレッドを使うより単一スレッドで処理するのがベターだと思います。」

### 理由を説明する
下記がどのようにコード健全性を高めるのか、といった説明を付け加えると良い。

* その意図や背景
* ベストプラクティス
* 提案

## 方向性を示す
基本的に、コード変更(CL: Change List)を修正する責任は開発者にある。
レビュアーが詳細な設計案を提示したり、コードを書き直してあげたりする義務はない。

とはいえ、非協力的であってよいという意味ではない。
下記二つのバランスを取ることが大切。

* 問題点だけを指摘して、修正は開発者に任せるやり方
* 具体的な指示やサンプルコードを提示するやり方

また、開発者が既にうまくできている点を見つけたら、それも[コメントで称賛](./what-to-look#良い点)してあげよう!

## コメントの重要度を明示する
レビューコメントの重要度を示すと、修正が開発者に分かりやすくなる。

* 必須: 必ず修正してほしい
* 推奨: 出来れば修正してほしい
* 単なる情報
    * Nit: 細かいポイント。一応、修正してほしい（したほうが良い）が、最終的な影響は大きくない。
    * Optional (あるいは Consider): 「やってみると良いかもしれない」が、厳密には必須ではない。
    * FYI: 「今後参考になるかもしれない情報」で、このCLで直す必要はない。

こうしたラベルを使うことでレビューの意図が明確になり、開発者はコメントの優先度を判断しやすくなる。
また、すべてのコメントを「必須修正」と誤解されるリスクも減らせる。

## 説明を受け入れる
もしあなたがあるコードを理解できず、開発者に説明を求めた場合、その結果としてコードをより分かりやすく書き換えてもらうのが理想的である。
場合によっては、コメントをコードに追加する対応でも構わないが、複雑すぎるコードを「コメントで解説する」だけに終わらないよう注意が必要。

コードレビューのツール(GithubのIssueやPull Request)上だけに書かれた説明は、将来そのコードを読む人には役立たない。
特殊な事情（レビュアーがあまり詳しくない領域で、通常の読者なら容易に理解できることであるなど）を除けば、コードレビューのやりとりだけに留まる説明は好ましくない。