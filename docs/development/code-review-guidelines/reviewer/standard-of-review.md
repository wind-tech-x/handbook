---
sidebar_position: 1
---

# コードレビュー標準

## まとめ
* コードレビューの目的は、コードの健全性を向上させるためである。
* コード変更(CL: Change List)がコードの健全性を向上させる状態に達したとき、完璧でなくても承認を優先すべきである。
* 技術的事実やデータが、意見や個人的な好みを上回る。
* スタイルに関しては、[スタイルガイド](../coding-guidelines/style-guide)を基準とする。
* 標準的なソフトウェア設計の原則に常に従うべきである。
* 現行のコードベースとの一貫性が求められる。
* レビュアーと開発者間の対立は、工夫して解決する。

## コードレビューの目的

コードの全体的な健全性を時間とともに向上させることを目的とする。
コードレビューに関わるあらゆるツールやプロセスは、この目的を達成するために設計される。

### 開発者とレビュアーの関係

開発者とレビュアーのトレードオフの関係をバランスよく考慮しなければならない。

#### 開発者

* 自分のタスクを前進させる必要がある。

もし、コードの改善を提出しない（あるいは提出できない）のであれば、コードは決して改善されない。
一方でレビュアーがCLを極端に受け入れないと、将来的に開発者の意欲が低下してしまい、コードの改善を行う機会が減ってしまう。

#### レビュアー

* レビュー対象のコードが時間の経過とともに健全性を損なわないようにする必要がある。
* レビュー対象のコードに対して所有権と責任を持っている。
* コードベースが一貫性を保ち、保守しやすく、また「コードレビューで見るべき点」に挙げられる他の要件も満たしていることを確認する。

### 最も重要な原則

**一般的には、CL がシステム全体のコード健全性を明確に向上させる状態に達したら、完璧ではなくても承認を優先すべきである。**

ここでの重要なポイントは、**「完璧」なコードというものは存在せず、より良いコードがあるだけ**ということだ。
レビュアーは開発者に対して、CLのあらゆる細部を完璧に仕上げることを要求すべきではない。
むしろ、レビュアーがすべきことは、CLの改良を提案する重要度と、前に進む必要性をバランス良く考慮することである。

レビュアーが目指すべきは完璧さではなく**継続的な改善**だ。

メンテナビリティ、可読性、理解しやすさといった観点で、システム全体として向上が見込めるCLであれば、「完璧」ではないからという理由で数日または数週間も遅らせるべきではない。

レビュアーは常に「もう少しこうすると良くなる」というコメントを自由に書けるが、
それが非常に重要というわけではない場合は、「[Nit:](./review-comment#コメントの重要度を明示する)」のように書き始めて、開発者に対して「修正は必須ではない」ということを示すのがよい。

:::note

例外として、たとえば、レビュアーが望まない機能をシステムに追加するCLがあった場合、たとえコードの設計が優れていても、レビュアーは承認を拒否することが出来る。

:::

:::warning

システムの全体的なコード健全性を明らかに損なうCLを承認していいという意味ではない。

そうした対応をする可能性があるのは、[緊急時](./emergencies)のみである。

:::

#### メンターとしての役割
コードレビューは、開発者が言語やフレームワーク、ソフトウェア設計の原則などについて新しいことを学ぶ場としても重要である。
開発者が新しい知識を習得できるように、レビューコメントを残すことは常に歓迎される。
知識を共有することは、長期的にコードベースの健全性を高める一助となる。
ただし、そのコメントが純粋に教育的であり、この文書で示される基準を満たすために必須の指摘でない場合は、「[Nit:](./review-comment#コメントの重要度を明示する)」のように書き始めて、
著者がこのCLで必ず対応しなくてもよいことを示すようにする。

### 原則
* 技術的事実やデータが、意見や個人的な好みを上回る。

* スタイルに関しては、[スタイルガイド](../coding-guidelines/style-guide)が絶対的な基準となる。

* ソフトウェア設計は、純粋なスタイル問題や個人的好みだけでなく、標準的なソフトウェア設計の原則に常に従うべきである。

* 現行のコードベースとの一貫性が求められる。ただし、それによってシステムのコード健全性が損なわれないことが条件となる。

### コンフリクト（対立）の解決
コードレビューで何らかの対立が起きた場合、まず最初にやるべきことは、開発者とレビュアーがこの文書や「[コーディングガイドライン](../coding-guidelines/)」、「[レビューガイドライン](./)」の内容を基に合意点を見出すことである。

もし、合意形成が極めて難しい場合、単にコードレビューのコメントのやり取りだけでなく、対面やビデオ会議などを利用し、直接やり取りを行う。
（その際、結論は必ずCL上のコメントにも残し、将来の読者にも分かるようにしておく。）

それでも解決しない場合、多くの場合はエスカレーション（上位へ判断を仰ぐ）によって解決する。
たとえば、次のような方法が考えられる。

* より広いチームで議論する
* テクニカルリードの判断を仰ぐ
* コードの管理者の判断を仰ぐ
* エンジニアリングマネージャーに助言を求める

開発者とレビュアーの間で合意が得られず、CLが放置されることは避けよう。