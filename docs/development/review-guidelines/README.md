---
sidebar_position: 2
---

# レビューガイドライン


## コードレビューの目的

コードの全体的な健全性を時間とともに向上させることを目的とする。
コードレビューに関わるあらゆるツールやプロセスは、この目的を達成するために設計される。

### 開発者とレビュアーの関係

開発者とレビュアーのトレードオフの関係をバランスよく考慮しなければならない。

#### 開発者

* 自分のタスクを前進させられる必要がある。

もし、コードの改善を提出しない（あるいは提出できない）のであれば、コードは決して改善されない。
一方でレビュアーがコード変更(CL: Change List)を極端に受け入れないと、将来的に開発者の意欲が低下してしまい、コードの改善を行う機会が減ってしまう。

#### レビュアー

* レビュー対象のコードが時間の経過とともに健全性を損なわないようにする必要がある。
* レビュー対象のコードに対して所有権と責任を持っている。
* コードベースが一貫性を保ち、保守しやすく、また「コードレビューで見るべき点」に挙げられる他の要件も満たしていることを確認する。

### 標準的なルール

**一般的には、CL がシステム全体のコード健全性を明確に向上させる状態に達したら、完璧ではなくても承認を優先すべきである。**

これは、すべてのコードレビューガイドラインの中でも最も重要な原則です。

もちろん、例外はあります。たとえば、レビュアーが望まない機能をシステムに追加する CL があった場合、たとえコードの設計が優れていても、レビュアーは承認を拒否することができます。

ここでの重要なポイントは、「完璧」なコードというものは存在しない、ということです。より良いコードがあるだけです。レビュアーは著者に対して、CL のあらゆる細部を完璧に仕上げることを要求すべきではありません。むしろ、レビュアーがすべきことは、CL 提案の改良を提案する重要度と、前に進む必要性をバランス良く考慮することです。レビュアーが目指すべきは完璧さではなく「継続的な改善」です。メンテナビリティ、可読性、理解しやすさといった観点で、システム全体として向上が見込める CL であれば、「完璧」ではないからという理由で数日または数週間も遅らせるべきではありません。

レビュアーは常に「もう少しこうすると良くなる」というコメントを自由に書けますが、それが非常に重要というわけではない場合は、「Nit: 」のように書き始めて、著者に対して「修正は必須ではない」ということを示すのがよいでしょう。

注: この文書のどこにも、システムの全体的なコード健全性を明らかに損なう CL をチェックインして良いという内容はありません。そうした対応をするのは、緊急時だけです。

#### メンターとしての役割
コードレビューは、開発者が言語やフレームワーク、ソフトウェア設計の原則などについて新しいことを学ぶ場としても重要です。
開発者が新しい知識を習得できるように、コメントを残すことは常に歓迎されます。
知識を共有することは、長期的にコードベースの健全性を高める一助となります。
ただし、そのコメントが純粋に教育的であり、この文書で示される基準を満たすために必須の指摘でない場合は、「Nit: 」のように書き始めて、
著者がこの CL で必ず対応しなくてもよいことを示すようにしましょう。

### 原則
* **技術的事実やデータが、意見や個人的な好みを上回る。**

* スタイルに関しては、スタイルガイドが絶対的な基準です。
余白やインデントなどスタイルガイドに明示されていない純粋なスタイル上の問題は、個人的な好みに過ぎません。既存のスタイルがある場合はそれに合わせましょう。既存のスタイルがない場合、著者のスタイルを受け入れてください。

* ソフトウェア設計の側面は、ほぼ常に純粋なスタイル問題や個人的好みだけでなく、基本的な原則に基づきます。

* 設計にいくつか妥当な選択肢がある場合、もし著者がデータやエンジニアリングの原則に基づいて複数のアプローチが同等に有効であることを示せるのであれば、レビュアーは著者の選択を受け入れるべきです。それ以外の場合は、標準的なソフトウェア設計の原則に従うべきです。

* 他のルールが適用されない場合には、現行のコードベースとの一貫性を求めることができます。ただし、それによってシステムのコード健全性が損なわれないことが条件です。

### コンフリクト（対立）の解決
コードレビューで何らかの対立が起きた場合、まず最初にやるべきことは、開発者とレビュアーがこの文書や「CL 著者ガイド」「レビューガイド」の内容を基に合意点を見いだそうとすることです。

もし、合意形成が極めて難しい場合、単にコードレビューのコメントのやり取りだけでなく、対面やビデオ会議などで話し合うと良いでしょう。
（その際、結論は必ず CL 上のコメントにも残し、将来の読者にも分かるようにします。）

それでも解決しない場合、多くの場合はエスカレーション（上位へ判断を仰ぐ）によって解決します。
たとえば、より広いチームで議論したり、テクニカルリードの判断を仰いだり、コードのメンテナ（管理者）に決定を求めたり、エンジニアリングマネージャーに助言を求めたりする方法があります。
著者とレビュアーの間で合意が得られず、CL が放置されることは避けましょう。

## レビュー実施ルール

## 対面レビュー
* **実装範囲の概要**を30分で説明する。
* 実装範囲が30分で説明できる分量に調整する。
* 数行の修正やコードを見れば明らかなものは、スキップしてOK

## コードレビュー
* 全員でレビューする
  * 知識が無くて、よくわからなくても一通り目を通す
* レビュー中はどうしても説明口調になるので、怒ったり、責めたりしている訳ではないことを理解する。

## 参考文献
* [Googleのレビューガイドライン](https://google.github.io/eng-practices/review/reviewer/)
